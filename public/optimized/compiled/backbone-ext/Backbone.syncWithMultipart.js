(function(){define(["vendor/backbone","underscore","jquery","compiled/behaviors/authenticity_token"],function(e,t,n,r){return e.syncWithoutMultipart=e.sync,e.syncWithMultipart=function(e,o,i){var u,a,c,d,l,p,m,s;return p=t.uniqueId("file_upload_iframe_"),a=n("<iframe id='"+p+"' name='"+p+"' ></iframe>").hide(),d=new n.Deferred,l={create:"POST",update:"PUT","delete":"DELETE",read:"GET"}[e],m=function(e,r,o){var i;return i=t.map(e,function(e,i){var u,a;return r&&(i=""+r+"["+(o?"":i)+"]"),t.isElement(e)?(a=n(e),a.after(a.clone(!0)),e):t.isEmpty(e)||!t.isArray(e)&&"object"!=typeof e?(""+i).match(/^_/)||null==e||"object"==typeof e||"function"==typeof e?void 0:(u=n("<input/>",{name:i,value:e}),u[0]):m(e,i,t.isArray(e))}),t.flatten(i)},u=n("<form enctype='multipart/form-data' target='"+p+"' action='"+(null!=(s=i.url)?s:o.url())+"' method='POST'>\n</form>").hide(),i.proxyAttachment&&u.prepend("<input type='hidden' name='_method' value='"+l+"' />\n<input type='hidden' name='authenticity_token' value='"+r()+"' />"),t.each(m(o.toJSON()),function(e){return e?"file"===e.name?u.append(e):u.prepend(e):void 0}),n(document.body).prepend(a,u),c=function(){var e,t,r,o,c;return e=null!=(r=a[0].contentDocument||(null!=(o=a[0].contentWindow)?o.document:void 0))?r.body:void 0,(t=n.parseJSON(n(e).text()))?(t=null!=(c=t.objects)?c:t,"error"===e.className?("function"==typeof i.error&&i.error(t),d.reject(t)):("function"==typeof i.success&&i.success(t),d.resolve(t)),a.remove(),u.remove()):void 0},a[0].onreadystatechange=function(){return"complete"===this.readyState?c():void 0},a[0].onload=c,u[0].submit(),d},e.sync=function(t,n,r){return(null!=r?r.multipart:void 0)?e.syncWithMultipart.apply(this,arguments):e.syncWithoutMultipart.apply(this,arguments)}})}).call(this);