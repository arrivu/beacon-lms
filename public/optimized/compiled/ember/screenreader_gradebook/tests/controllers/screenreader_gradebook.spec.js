(function(){define(["jquery","underscore","../start_app","ember","../shared_ajax_fixtures","../../controllers/screenreader_gradebook_controller","compiled/userSettings","vendor/jquery.ba-tinypubsub"],function(e,t,s,n,r,i,o){var u,a,c,g,l,d,h,b,m;return u=null,d=null,h=null,l=function(e){return Em.copy(e,!0)},r.create(),b=function(e,t){var a=this;return null==e&&(e=!1),null==t&&(t="assignment_group"),window.ENV.GRADEBOOK_OPTIONS.draft_state_enabled=e,h=window.ENV.GRADEBOOK_OPTIONS.group_weighting_scheme,this.contextGetStub=sinon.stub(o,"contextGet"),this.contextSetStub=sinon.stub(o,"contextSet"),this.contextGetStub.withArgs("sort_grade_columns_by").returns({sortType:t}),this.contextSetStub.returns({sortType:t}),u=s(),n.run(function(){return a.srgb=i.create(),a.srgb.set("model",{enrollments:n.ArrayProxy.create({content:l(r.students)}),assignment_groups:n.ArrayProxy.create({content:l(r.assignment_groups)}),submissions:n.ArrayProxy.create({content:[]}),sections:n.ArrayProxy.create({content:l(r.sections)}),outcomes:n.ArrayProxy.create({content:l(r.outcomes)}),outcome_rollups:n.ArrayProxy.create({content:l(r.outcome_rollups)})})})},m=function(){return window.ENV.GRADEBOOK_OPTIONS.draft_state_enabled=!1,window.ENV.GRADEBOOK_OPTIONS.group_weighting_scheme=h,this.contextGetStub.restore(),this.contextSetStub.restore(),n.run(u,"destroy")},module("screenreader_gradebook_controller",{setup:function(){return b.call(this)},teardown:function(){return m.call(this)}}),test("calculates students properly",function(){return equal(this.srgb.get("students.length"),10),equal(this.srgb.get("students.firstObject").name,r.students[0].user.name)}),test("calculates assignments properly",function(){return equal(this.srgb.get("assignments.length"),7),ok(!this.srgb.get("assignments").findBy("name","Not Graded")),equal(this.srgb.get("assignments.firstObject").name,r.assignment_groups[0].assignments[0].name)}),test("calculates outcomes properly",function(){return equal(this.srgb.get("outcomes.length"),2),equal(this.srgb.get("outcomes.firstObject").title,r.outcomes[0].title)}),test("studentsHash returns the expected hash",function(){var e=this;return t.each(this.srgb.studentsHash(),function(t){return strictEqual(e.srgb.get("students").findBy("id",t.id),t)})}),test("assignmentGroupsHash retuns the expected hash",function(){var e=this;return t.each(this.srgb.assignmentGroupsHash(),function(t){return strictEqual(e.srgb.get("assignment_groups").findBy("id",t.id),t)})}),test("student objects have isLoaded flag set to true once submissions are loaded",function(){return this.srgb.get("students").forEach(function(e){return equal(n.get(e,"isLoaded"),!0)})}),test("displayName is hiddenName when hideStudentNames is true",function(){return this.srgb.set("hideStudentNames",!0),equal(this.srgb.get("displayName"),"hiddenName"),this.srgb.set("hideStudentNames",!1),equal(this.srgb.get("displayName"),"name")}),test("displayPointTotals is false when groups are weighted even if showTotalAsPoints is true",function(){var e=this;return n.run(function(){return e.srgb.set("showTotalAsPoints",!0),e.srgb.set("groupsAreWeighted",!0),equal(e.srgb.get("displayPointTotals"),!1)})}),test("displayPointTotals is toggled by showTotalAsPoints when groups are unweighted",function(){var e=this;return n.run(function(){return e.srgb.set("groupsAreWeighted",!1),e.srgb.set("showTotalAsPoints",!0),equal(e.srgb.get("displayPointTotals"),!0),e.srgb.set("showTotalAsPoints",!1),equal(e.srgb.get("displayPointTotals"),!1)})}),test("updateSubmission attaches the submission to the student",function(){var e,t;return e=l(r.students[0].user),t=l(r.submissions[e.id].submissions[0]),this.srgb.updateSubmission(t,e),strictEqual(e["assignment_"+t.assignment_id],t)}),test("studentsInSelectedSection is the same as students when selectedSection is null",function(){return ok(!this.srgb.get("selectedSection")),deepEqual(this.srgb.get("students"),this.srgb.get("studentsInSelectedSection"))}),test("selecting a section filters students properly",function(){var e=this;return n.run(function(){return e.srgb.set("selectedSection",e.srgb.get("sections.lastObject"))}),equal(this.srgb.get("studentsInSelectedSection.length"),6),equal(this.srgb.get("studentsInSelectedSection.firstObject").name,"Buffy")}),test("sorting assignments by position",function(){var e=this;return n.run(function(){return e.srgb.set("assignmentSort",e.srgb.get("assignmentSortOptions").findBy("value","assignment_group"))}),equal(this.srgb.get("assignments.firstObject.name"),"Z Eats Soup"),equal(this.srgb.get("assignments.lastObject.name"),"Da Fish and Chips!")}),test("updates assignment groups and weightingScheme when event is triggered",function(){return window.ENV.GRADEBOOK_OPTIONS.group_weighting_scheme="whoa",n.run(function(){return e.publish("assignment_group_weights_changed",{assignmentGroups:n.copy(r.assignment_groups,!0).slice(0,1)})}),equal(this.srgb.get("weightingScheme"),"whoa","weightingScheme was updated"),equal(this.srgb.get("assignment_groups.length"),1,"assignment_groups was updated")}),module("screenreader_gradebook_controller: sorting alpha",{setup:function(){return b.call(this,!1,"alpha")},teardown:function(){return m.call(this)}}),test("sorting assignments alphabetically",function(){var e=this;return n.run(function(){return e.srgb.set("assignmentSort",e.srgb.get("assignmentSortOptions").findBy("value","alpha"))}),equal(this.srgb.get("assignments.firstObject.name"),"Apples are good"),equal(this.srgb.get("assignments.lastObject.name"),"Z Eats Soup")}),module("screenreader_gradebook_controller: sorting due_date",{setup:function(){return b.call(this,!1,"due_date")},teardown:function(){return m.call(this)}}),test("sorting assignments by due date",function(){var e=this;return n.run(function(){return e.srgb.set("assignmentSort",e.srgb.get("assignmentSortOptions").findBy("value","due_date"))}),equal(this.srgb.get("assignments.firstObject.name"),"Can You Eat Just One?"),equal(this.srgb.get("assignments.lastObject.name"),"Drink Water")}),module("screenreader_gradebook_controller: with selected student",{setup:function(){var e=this;return b.call(this),n.run(function(){var t;return t=e.srgb.get("students.firstObject"),e.srgb.set("selectedStudent",t)})},teardown:function(){return m.call(this)}}),test("selectedSubmission should be null when just selectedStudent is set",function(){return strictEqual(this.srgb.get("selectedSubmission"),null)}),module("screenreader_gradebook_controller: with selected student, assignment, and outcome",{setup:function(){var e=this;return b.call(this),n.run(function(){return e.student=e.srgb.get("students.firstObject"),e.assignment=e.srgb.get("assignments.firstObject"),e.outcome=e.srgb.get("outcomes.firstObject"),e.srgb.set("selectedStudent",e.student),e.srgb.set("selectedAssignment",e.assignment),e.srgb.set("selectedOutcome",e.outcome)})},teardown:function(){return m.call(this)}}),test("assignmentDetails is computed properly",function(){var e,t;return e=this.srgb.get("assignmentDetails"),t=this.srgb.get("selectedAssignment"),strictEqual(e.assignment,t),strictEqual(e.cnt,3)}),test("outcomeDetails is computed properly",function(){var e,t;return e=this.srgb.get("outcomeDetails"),t=this.srgb.get("selectedOutcome"),strictEqual(e.cnt,1)}),test("selectedSubmission is computed properly",function(){var e,s,n,i=this;return e=this.srgb.get("selectedSubmission"),s=t.find(r.submissions,function(e){return e.user_id===i.student.id}),n=t.find(s.submissions,function(e){return e.assignment_id===i.assignment.id}),t.each(n,function(t,s){return equal(e[s],t,""+s+" is the expected value on selectedSubmission")})}),module("screenreader_gradebook_controller: with selected assignment",{setup:function(){var e=this;return b.call(this),this.assignment=this.srgb.get("assignments.firstObject"),n.run(function(){return e.srgb.set("selectedAssignment",e.assignment)})},teardown:function(){return this.contextGetStub.restore(),this.contextSetStub.restore(),n.run(u,"destroy")}}),test("gets the submission types",function(){var e=this;return equal(this.srgb.get("assignmentSubmissionTypes"),"None"),n.run(function(){var t;return t=e.srgb.get("assignments"),e.srgb.set("selectedAssignment",t.objectAt(1))}),equal(this.srgb.get("assignmentSubmissionTypes"),"Online URL, Online text entry")}),module("screenreader_gradebook_controller:draftState",{setup:function(){var e=this;return b.call(this,!0),Em.run(function(){return e.srgb.get("assignment_groups").pushObject({id:"100",name:"Silent Assignments",position:2,assignments:[{id:"21",name:"Unpublished Assignment",points_possible:10,grading_type:"percent",submission_types:["none"],due_at:null,position:6,assignment_group_id:"4",published:!1}]})})},teardown:function(){return m.call(this)}}),test("calculates assignments properly",function(){return equal(this.srgb.get("assignments.length"),7),ok(!this.srgb.get("assignments").findBy("name","Unpublished Assignment"))}),a={group_sums:[{"final":{possible:100,score:50,submission_count:10,weight:50,submissions:[]},current:{possible:100,score:20,submission_count:5,weight:50,submissions:[]},group:{id:"1"}}],"final":{possible:100,score:90},current:{possible:88,score:70}},c={group_sums:[{"final":{possible:0,score:50,submission_count:10,weight:50,submissions:[]},current:{possible:0,score:20,submission_count:5,weight:50,submissions:[]},group:{id:"1"}}],"final":{possible:0,score:0},current:{possible:0,score:0}},g=function(e){var t=this;return null==e&&(e=a),u=s(),n.run(function(){return t.srgb=i.create(),t.srgb.reopen({calculate:function(){return e}}),t.srgb.set("model",{enrollments:n.ArrayProxy.create({content:l(r.students)}),assignment_groups:n.ArrayProxy.create({content:l(r.assignment_groups)}),submissions:n.ArrayProxy.create({content:[]}),sections:n.ArrayProxy.create({content:l(r.sections)})})})},module("screenreader_gradebook_controller: grade calc",{setup:function(){return g.call(this)}}),test("calculates final grade",function(){return equal(this.srgb.get("students.firstObject.total_percent"),79.5)}),module("grade calc with 0s",{setup:function(){return g.call(this,c)}}),test("calculates final grade",function(){return equal(this.srgb.get("students.firstObject.total_percent"),0)}),module("screenreader_gradebook_controller: notes computed props",{setup:function(){var e=this;return ENV.GRADEBOOK_OPTIONS.custom_column_url="/here/is/an/:id",ENV.GRADEBOOK_OPTIONS.teacher_notes={id:"42"},this.server=sinon.fakeServer.create(),b.call(this),n.run(function(){return e.srgb.reopen({updateOrCreateNotesColumn:function(){}})})},teardown:function(){return ENV.GRADEBOOK_OPTIONS.custom_column_url=null,ENV.GRADEBOOK_OPTIONS.teacher_notes=null,this.server.restore(),m.call(this)}}),test("computes showNotesColumn correctly",function(){return ENV.GRADEBOOK_OPTIONS.teacher_notes={hidden:!1},equal(this.srgb.get("showNotesColumn"),!0),ENV.GRADEBOOK_OPTIONS.teacher_notes={hidden:!0},equal(this.srgb.get("showNotesColumn"),!1),ENV.GRADEBOOK_OPTIONS.teacher_notes=null,equal(this.srgb.get("showNotesColumn"),!1)}),test("shouldCreateNotes, no notes in ENV",function(){var e=this;return ENV.GRADEBOOK_OPTIONS.teacher_notes=null,n.run(function(){return e.srgb.set("showNotesColumn",!0)}),equal(this.srgb.get("shouldCreateNotes"),!0,"true if no teacher_notes and showNotesColumns is true")}),test("shouldCreateNotes, notes in ENV, hidden",function(){var e,t=this;return ENV.GRADEBOOK_OPTIONS.teacher_notes={hidden:!0},n.run(function(){return t.srgb.set("showNotesColumn",!0)}),e=this.srgb.get("shouldCreateNotes"),equal(e,!1,"does not create if there is a teacher_notes object in the ENV")}),test("shouldCreateNotes, notes in ENV, shown",function(){var e=this;return ENV.GRADEBOOK_OPTIONS.teacher_notes={hidden:!1},n.run(function(){return e.srgb.set("showNotesColumn",!0)}),equal(this.srgb.get("shouldCreateNotes"),!1,"does not create if there is a teacher_notes object in the ENV")}),test("notesURL, no notes object in ENV",function(){var e=this;return n.run(function(){return e.srgb.set("shouldCreateNotes",!0)}),equal(this.srgb.get("notesURL"),ENV.GRADEBOOK_OPTIONS.custom_columns_url,"computes properly when creating"),n.run(function(){return e.srgb.set("shouldCreateNotes",!1)}),equal(this.srgb.get("notesURL"),"/here/is/an/42","computes properly when showing")}),test("notesParams",function(){var e=this;return n.run(function(){return e.srgb.set("showNotesColumn",!0),e.srgb.set("shouldCreateNotes",!1)}),deepEqual(this.srgb.get("notesParams"),{"column[hidden]":!1}),n.run(function(){return e.srgb.set("showNotesColumn",!1),e.srgb.set("shouldCreateNotes",!1)}),deepEqual(this.srgb.get("notesParams"),{"column[hidden]":!0}),n.run(function(){return e.srgb.set("showNotesColumn",!0),e.srgb.set("shouldCreateNotes",!0)}),deepEqual(this.srgb.get("notesParams"),{"column[title]":"Notes","column[position]":1,"column[teacher_notes]":!0})}),test("notesVerb",function(){var e=this;return n.run(function(){return e.srgb.set("shouldCreateNotes",!0)}),equal(this.srgb.get("notesVerb"),"POST"),n.run(function(){return e.srgb.set("shouldCreateNotes",!1)}),equal(this.srgb.get("notesVerb"),"PUT")}),module("screenreader_gradebook_controller:invalidGroups",{setup:function(){var e=this;return b.call(this,!0),Em.run(function(){return e.srgb.set("assignment_groups",n.ArrayProxy.create({content:l(r.assignment_groups)}))})},teardown:function(){return m.call(this)}}),test("calculates invalidGroupsWarningPhrases properly",function(){return equal(this.srgb.get("invalidGroupsWarningPhrases"),"Note: Score does not include assignments from the group Invalid AG because it has no points possible.")}),test("sets showInvalidGroupWarning to false if groups are not weighted",function(){var e=this;return n.run(function(){return e.srgb.set("weightingScheme","equal"),equal(e.srgb.get("showInvalidGroupWarning"),!1),e.srgb.set("weightingScheme","percent"),equal(e.srgb.get("showInvalidGroupWarning"),!0)})}),module("screenreader_gradebook_controller: differentiated assignments",{setup:function(){return b.call(this,!0)},teardown:function(){return m.call(this)}}),test("selectedSubmissionHidden is false when students have visibility",function(){var e,t,s=this;return t=this.srgb.get("students.firstObject"),e=this.srgb.get("assignments.firstObject"),n.run(function(){return s.srgb.set("selectedAssignment",e),s.srgb.set("selectedStudent",t),equal(s.srgb.get("selectedSubmissionHidden"),!1)})}),test("selectedSubmissionHidden is false when students have visibility",function(){var e,t,s=this;return t=this.srgb.get("students").objectAt(2),e=this.srgb.get("assignments.firstObject"),n.run(function(){return s.srgb.set("selectedAssignment",e),s.srgb.set("selectedStudent",t),equal(s.srgb.get("selectedSubmissionHidden"),!0)})})})}).call(this);