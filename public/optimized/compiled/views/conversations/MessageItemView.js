(function(){var t={}.hasOwnProperty,e=function(e,r){function o(){this.constructor=e}for(var n in r)t.call(r,n)&&(e[n]=r[n]);return o.prototype=r.prototype,e.prototype=new o,e.__super__=r.prototype,e};define(["i18n!conversations","jquery","underscore","timezone","Backbone","jst/conversations/messageItem","jst/_avatar"],function(t,r,o,n,i,a){var s,p,u;return p=i.View,s=function(i){function s(){return u=s.__super__.constructor.apply(this,arguments)}return e(s,i),s.prototype.tagName="li",s.prototype.className="message-item-view",s.prototype.template=a,s.prototype.els={".message-participants-toggle":"$toggle",".message-participants":"$participants",".summarized-message-participants":"$summarized",".full-message-participants":"$full",".message-metadata":"$metadata"},s.prototype.events={"blur .actions a":"onActionBlur","click .al-trigger":"onMenuOpen","click .delete-btn":"onDelete","click .forward-btn":"onForward","click .message-participants-toggle":"onToggle","click .reply-btn":"onReply","click .reply-all-btn":"onReplyAll","focus .actions a":"onActionFocus"},s.prototype.messages={confirmDelete:t.t("confirm.delete_message","Are you sure you want to delete your copy of this message? This action cannot be undone.")},s.prototype.initialize=function(){return s.__super__.initialize.apply(this,arguments),this.summarized=this.model.get("summarizedParticipantNames")},s.prototype.toJSON=function(){var t,e;return e=this.model.toJSON(),t=r.fudgeDateForProfileTimezone(n.parse(e.created_at)),o.extend(e,{created_at:t})},s.prototype.afterRender=function(){return s.__super__.afterRender.apply(this,arguments),this.updateParticipants(this.summarized),this.$el.attr("data-id",this.model.id)},s.prototype.updateParticipants=function(e){var r;return r=e?this.$summarized:this.$full,this.$participants.text(r.text()),this.$toggle.text(e?t.t("more_participants","+%{total} more",{total:this.model.get("hiddenParticipantCount")}):t.t("hide","Hide"))},s.prototype.onToggle=function(t){return t.preventDefault(),this.updateParticipants(this.summarized=!this.summarized)},s.prototype.onReply=function(t){return t.preventDefault(),this.trigger("reply")},s.prototype.onReplyAll=function(t){return t.preventDefault(),this.trigger("reply-all")},s.prototype.onDelete=function(t){var e;return t.preventDefault(),confirm(this.messages.confirmDelete)?(e="/api/v1/conversations/"+this.model.get("conversation_id")+"/remove_messages",r.ajaxJSON(e,"POST",{remove:[this.model.id]}),this.remove()):void 0},s.prototype.onForward=function(t){return t.preventDefault(),this.trigger("forward")},s.prototype.onMenuOpen=function(t){return t.preventDefault()},s.prototype.onActionFocus=function(){return this.$metadata.addClass("hover")},s.prototype.onActionBlur=function(){return this.$metadata.removeClass("hover")},s}(p)})}).call(this);