(function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};define(["compiled/util/round","i18n!assignments","jquery","underscore","compiled/models/AssignmentGroup","compiled/collections/NeverDropCollection","compiled/views/assignments/NeverDropCollectionView","compiled/views/DialogFormView","jst/assignments/CreateGroup","jst/EmptyDialogFormWrapper"],function(e,r,o,n,s,i,p,a,u,l){var m,g,h;return g=250,m=function(a){function m(){return h=m.__super__.constructor.apply(this,arguments)}return t(m,a),m.prototype.defaults={width:600,height:500},m.prototype.events=n.extend({},m.prototype.events,{"click .dialog_closer":"close","blur .group_weight":"roundWeight"}),m.prototype.els={".never_drop_rules_group":"$neverDropContainer"},m.prototype.template=u,m.prototype.wrapperTemplate=l,m.optionProperty("assignmentGroups"),m.optionProperty("assignmentGroup"),m.optionProperty("course"),m.prototype.messages={non_number:r.t("non_number","You must use a number"),positive_number:r.t("positive_number","You must use a positive number"),max_number:r.t("higher_than_max","You cannot use a number greater than the number of assignments"),no_name_error:r.t("no_name_error","A name is required"),name_too_long_error:r.t("name_too_long_error","Name is too long")},m.prototype.initialize=function(){return m.__super__.initialize.apply(this,arguments),this.model=this.assignmentGroup||new s({assignments:[]})},m.prototype.onSaveSuccess=function(){return m.__super__.onSaveSuccess.apply(this,arguments),this.assignmentGroup?this.model.collection.trigger("render",this.model.collection):(this.assignmentGroups.add(this.model),this.model=new s({assignments:[]}),this.render())},m.prototype.getFormData=function(){var e,t;return e=m.__super__.getFormData.apply(this,arguments),e.rules&&(n.contains(["","0"],e.rules.drop_lowest)&&delete e.rules.drop_lowest,n.contains(["","0"],e.rules.drop_highest)&&delete e.rules.drop_highest,0===(null!=(t=e.rules.never_drop)?t.length:void 0)&&delete e.rules.never_drop),e},m.prototype.validateFormData=function(e){var t,r,o,s=this;return o=0,this.assignmentGroup&&(t=this.assignmentGroup.get("assignments"),null!=t&&(o=t.size())),r={},e.name.length>255&&(r.name=[{type:"name_too_long_error",message:this.messages.name_too_long_error}]),""===e.name&&(r.name=[{type:"no_name_error",message:this.messages.no_name_error}]),n.each(e.rules,function(e,t){var n,i;if("never_drop"!==t)return i=parseInt(e),n="rules["+t+"]",isNaN(i)&&(r[n]=[{type:"number",message:s.messages.non_number}]),0>i&&(r[n]=[{type:"positive_number",message:s.messages.positive_number}]),i>o?r[n]=[{type:"maximum",message:s.messages.max_number}]:void 0}),r},m.prototype.showWeight=function(){var e,t;return e=this.course||(null!=(t=this.model.collection)?t.course:void 0),null!=e?e.get("apply_assignment_group_weights"):void 0},m.prototype.checkGroupWeight=function(){return this.showWeight()?this.$el.find(".group_weight").removeAttr("disabled"):this.$el.find(".group_weight").attr("disabled","disabled")},m.prototype.getNeverDrops=function(){var e;return this.$neverDropContainer.empty(),e=this.model.rules(),this.never_drops=new i([],{assignments:this.model.get("assignments"),ag_id:this.model.get("id")||"new"}),this.ndCollectionView=new p({collection:this.never_drops}),this.$neverDropContainer.append(this.ndCollectionView.render().el),e&&e.never_drop?this.never_drops.reset(e.never_drop,{parse:!0}):void 0},m.prototype.roundWeight=function(t){var r,n;return n=o(t.target).val(),r=e(parseFloat(n),2),o(t.target).val(r)},m.prototype.toJSON=function(){var e,t,r;return e=this.model.toJSON(),n.extend(e,{disable_weight:!this.showWeight(),group_weight:this.showWeight()?e.group_weight:null,label_id:this.model.get("id")||"new",drop_lowest:(null!=(t=this.model.rules())?t.drop_lowest:void 0)||0,drop_highest:(null!=(r=this.model.rules())?r.drop_highest:void 0)||0,editable_drop:this.model.get("assignments").length>0,number_input:navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)?"text":"number"})},m.prototype.openAgain=function(){return 0===this.model.get("assignments").length&&this.setDimensions(this.defaults.width,g),m.__super__.openAgain.apply(this,arguments),this.checkGroupWeight(),this.getNeverDrops()},m}(a)})}).call(this);