(function(){define(["jquery","react","compiled/react/shared/utils/withReactDOM","i18n!broccoli_cloud","compiled/models/FilesystemObject","./RestrictedDialogForm","../modules/customPropTypes","compiled/jquery.rails_flash_notifications"],function(t,e,l,s,a,o,n){var d;return d=e.createClass({displayName:"PublishCloud",propTypes:{model:n.filesystemObject,userCanManageFilesForContext:e.PropTypes.bool.isRequired},getInitialState:function(){return this.extractStateFromModel(this.props.model)},componentWillMount:function(){var t,e=this;return t=function(t){return e.setState(e.extractStateFromModel(t))},this.props.model.on("change",t,this)},componentWillUnmount:function(){return this.props.model.off(null,null,this)},extractStateFromModel:function(t){return{published:!t.get("locked"),restricted:!!t.get("lock_at")||!!t.get("unlock_at"),hidden:!!t.get("hidden")}},togglePublishedState:function(){return this.setState({published:!this.state.published,restricted:!1,hidden:!1})},openRestrictedDialog:function(){var i;return i=t("<div>").dialog({title:s.t("title.permissions","Editing permissions for: %{name}",{name:this.props.model.displayName()}),width:400,close:function(){return e.unmountComponentAtNode(this),t(this).remove()}}),e.renderComponent(o({models:[this.props.model],closeDialog:function(){return i.dialog("close")}}),i[0])},handleClick:function(t){return t.preventDefault(),this.openRestrictedDialog()},render:l(function(){return this.props.userCanManageFilesForContext?this.state.published&&this.state.restricted?button({"data-tooltip":"left",onClick:this.handleClick,ref:"publishCloud",className:"btn-link published-status restricted",title:s.t("restricted_title","Available from %{from_date} until %{until_date}",{from_date:t.datetimeString(this.props.model.get("unlock_at")),until_date:t.datetimeString(this.props.model.get("lock_at"))}),"aria-label":s.t("restricted_title","Available from %{from_date} until %{until_date}",{from_date:t.datetimeString(this.props.model.get("unlock_at")),until_date:t.datetimeString(this.props.model.get("lock_at"))})},i({className:"icon-calendar-day"})):this.state.published&&this.state.hidden?button({"data-tooltip":"left",onClick:this.handleClick,ref:"publishCloud",className:"btn-link published-status hiddenState",title:s.t("hidden_title","Hidden. Available with a link"),"aria-label":s.t("label.hidden","Hidden. Available with a link")},i({className:"icon-paperclip"})):this.state.published?button({"data-tooltip":"left",onClick:this.handleClick,ref:"publishCloud",className:"btn-link published-status published",title:s.t("published_title","Published"),"aria-label":s.t("label.published","Published")},i({className:"icon-publish"})):button({"data-tooltip":"left",onClick:this.handleClick,ref:"publishCloud",className:"btn-link published-status unpublished",title:s.t("unpublished_title","Unpublished"),"aria-label":s.t("label.unpublished","Unpublished")},i({className:"icon-unpublish"})):this.state.published&&this.state.restricted?div({style:{"margin-right":"12px"},"data-tooltip":"left",ref:"publishCloud",className:"published-status restricted",title:s.t("restricted_title","Available from %{from_date} until %{until_date}",{from_date:t.datetimeString(this.props.model.get("unlock_at")),until_date:t.datetimeString(this.props.model.get("lock_at"))}),"aria-label":s.t("restricted_title","Available from %{from_date} until %{until_date}",{from_date:t.datetimeString(this.props.model.get("unlock_at")),until_date:t.datetimeString(this.props.model.get("lock_at"))})},i({className:"icon-calendar-day"})):div({style:{width:28,height:36}})})})})}).call(this);