(function(){var e=[].indexOf||function(e){for(var r=0,t=this.length;t>r;r++)if(r in this&&this[r]===e)return r;return-1};define(["underscore","react","i18n!react_files","compiled/react/shared/utils/withReactDOM","../modules/filesEnv","./ColumnHeaders","./LoadingIndicator","./FolderChild","../utils/getAllPages","../utils/updateAPIQuerySortParams","compiled/models/Folder","./CurrentUploads","./FilePreview","./UploadDropZone"],function(r,t,o,s,n,i,l,d,u,p,c,a,h,f){var F,g;return F=/^\/[^\/]*/,g=t.createClass({displayName:"ShowFolder",debouncedForceUpdate:r.debounce(function(){return this.isMounted()?this.forceUpdate():void 0},0),registerListeners:function(e){return e.currentFolder?(e.currentFolder.folders.on("all",this.debouncedForceUpdate,this),e.currentFolder.files.on("all",this.debouncedForceUpdate,this)):void 0},unregisterListeners:function(){var e;return null!=(e=this.props.currentFolder)?e.off(null,null,this):void 0},buildFolderPath:function(e){return encodeURI("/"+(e||""))},getCurrentFolder:function(){var e,r,t,o,s,i=this;return o=this.buildFolderPath(this.props.params.splat),n.showingAllContexts?(s=o.split("/")[1],e=n.contextsDictionary[s]||n.contexts[0],t=e.contextType,r=e.contextId,o=o.replace(F,"")):(t=n.contextType,r=n.contextId),c.resolvePath(t,r,o).then(function(e){var r;return r=e[e.length-1],i.props.onResolvePath({currentFolder:r,rootTillCurrentFolder:e,showingSearchResults:!1}),[r.folders,r.files].forEach(function(e){return p(e,i.props.query),u(e,i.debouncedForceUpdate)})},function(e){var r;try{r=$.parseJSON(e.responseText)}catch(t){}return r?i.setState({errorMessages:r.errors}):void 0})},componentWillMount:function(){return this.registerListeners(this.props),this.getCurrentFolder()},componentWillUnmount:function(){var e=this;return this.unregisterListeners(),setTimeout(function(){return e.props.onResolvePath({currentFolder:void 0,rootTillCurrentFolder:void 0})})},componentWillReceiveProps:function(e){return this.unregisterListeners(),e.currentFolder?(this.registerListeners(e),[e.currentFolder.folders,e.currentFolder.files].forEach(function(r){return p(r,e.query)})):void 0},render:s(function(){var r,t=this;return(null!=(r=this.state)?r.errorMessages:void 0)?div({},this.state.errorMessages.map(function(e){return div({className:"muted"},e.message)})):this.props.currentFolder?div({role:"grid"},f({currentFolder:this.props.currentFolder}),a({}),i({to:this.props.params.splat?"folder":"rootFolder",query:this.props.query,toggleAllSelected:this.props.toggleAllSelected,areAllItemsSelected:this.props.areAllItemsSelected,splat:this.props.params.splat}),this.props.currentFolder.isEmpty()?div({ref:"folderEmpty",className:"muted"},o.t("this_folder_is_empty","This folder is empty")):this.props.currentFolder.children(this.props.query).map(function(r){return d({key:r.cid,model:r,isSelected:e.call(t.props.selectedItems,r)>=0,toggleSelected:t.props.toggleItemSelected.bind(null,r),userCanManageFilesForContext:t.props.userCanManageFilesForContext,dndOptions:t.props.dndOptions})}),l({isLoading:this.props.currentFolder.folders.fetchingNextPage||this.props.currentFolder.files.fetchingNextPage}),null!=this.props.query.preview?h({currentFolder:this.props.currentFolder,params:this.props.params,query:this.props.query}):void 0):div({ref:"emptyDiv"})})})})}).call(this);