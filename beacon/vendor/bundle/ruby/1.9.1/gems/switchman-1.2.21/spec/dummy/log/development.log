  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar(255) NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreateSwitchmanShards (20130328212039)
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36m (0.4ms)[0m  [1mCREATE TABLE "switchman_shards" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar(255), "database_server_id" varchar(255), "default" boolean DEFAULT 'f' NOT NULL) [0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20130328212039"]]
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
Migrating to CreateDefaultShard (20130328224244)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mSwitchman::Shard Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "switchman_shards" WHERE "switchman_shards"."default" = 't' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "switchman_shards" ("default") VALUES (?)  [["default", true]]
  [1m[36mSwitchman::Shard Load (0.1ms)[0m  [1mSELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."default" = 't' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  begin transaction  [shard 1 deploy]
  [1m[36mSQL (5023.8ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20130328224244"]]  [shard 1 deploy]
SQLite3::BusyException: database is locked: INSERT INTO "schema_migrations" ("version") VALUES (?)
  [1m[35m (0.1ms)[0m  rollback transaction  [shard 1 deploy]
  [1m[36m (6.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.3ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m
PG::UndefinedTable: ERROR:  relation "switchman_shards" does not exist
LINE 5:                WHERE a.attrelid = '"switchman_shards"'::regc...
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
                FROM pg_attribute a LEFT JOIN pg_attrdef d
                  ON a.attrelid = d.adrelid AND a.attnum = d.adnum
               WHERE a.attrelid = '"switchman_shards"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum

  [1m[35m (2.0ms)[0m  CREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
Migrating to CreateSwitchmanShards (20130328212039)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "switchman_shards" ("id" bigserial primary key, "name" character varying(255), "database_server_id" character varying(255), "default" boolean DEFAULT 'f' NOT NULL) 
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20130328212039"]]
  [1m[35m (0.4ms)[0m  COMMIT
Migrating to CreateDefaultShard (20130328224244)
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
  [1m[35mSwitchman::Shard Exists (0.5ms)[0m  SELECT 1 AS one FROM "switchman_shards" WHERE "switchman_shards"."default" = 't' LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "switchman_shards" ("default") VALUES ($1) RETURNING "id"[0m  [["default", true]]
  [1m[35mSwitchman::Shard Load (0.2ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."default" = 't' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20130328224244"]]
  [1m[35m (0.3ms)[0m  COMMIT
Migrating to CreateUsers (20130403132607)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (1.8ms)[0m  CREATE TABLE "users" ("id" bigserial primary key, "name" character varying(255), "mirror_user_id" bigint, "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20130403132607"]]
  [1m[35m (0.4ms)[0m  COMMIT
Migrating to CreateAppendages (20130411202442)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (1.7ms)[0m  CREATE TABLE "appendages" ("id" bigserial primary key, "user_id" bigint, "value" integer, "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20130411202442"]]
  [1m[35m (0.4ms)[0m  COMMIT
Migrating to CreateMirrorUsers (20130411202551)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (1.6ms)[0m  CREATE TABLE "mirror_users" ("id" bigserial primary key, "user_id" bigint, "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20130411202551"]]
  [1m[35m (0.3ms)[0m  COMMIT
Migrating to CreateDigits (20131022202028)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (1.6ms)[0m  CREATE TABLE "digits" ("id" bigserial primary key, "appendage_id" bigint, "value" integer, "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20131022202028"]]
  [1m[35m (0.3ms)[0m  COMMIT
Migrating to CreateFeatures (20131206172923)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (1.9ms)[0m  CREATE TABLE "features" ("id" bigserial primary key, "owner_id" bigint, "owner_type" character varying(255), "value" integer, "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20131206172923"]]
  [1m[35m (0.3ms)[0m  COMMIT
Migrating to AddParentIdToUsers (20140123154135)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  ALTER TABLE "users" ADD COLUMN "parent_id" bigint
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20140123154135"]]
  [1m[35m (0.3ms)[0m  COMMIT
Migrating to CreateRoots (20140219183820)
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (1.7ms)[0m  CREATE TABLE "roots" ("id" bigserial primary key, "user_id" bigint, "created_at" timestamp, "updated_at" timestamp) 
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES ($1)[0m  [["version", "20140219183820"]]
  [1m[35m (0.4ms)[0m  COMMIT
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[36m (1.0ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m
  [1m[35mSwitchman::Shard Load (0.3ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."default" = 't' LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m
  [1m[35mSwitchman::Shard Load (0.7ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."database_server_id" = 'test' AND "switchman_shards"."name" IS NULL ORDER BY "switchman_shards"."id" ASC LIMIT 1
  [1m[36mSwitchman::Shard Load (0.4ms)[0m  [1mSELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."database_server_id" = 'production' AND "switchman_shards"."name" IS NULL ORDER BY "switchman_shards"."id" ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  SELECT COUNT(*) FROM "users"  [shard 1 master]
  [1m[36m (2.2ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m
  [1m[35mSwitchman::Shard Load (2.5ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."default" = 't' ORDER BY "switchman_shards"."id" ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m
  [1m[35mSwitchman::Shard Load (2.0ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."database_server_id" = 'test' AND "switchman_shards"."name" IS NULL ORDER BY "switchman_shards"."id" ASC LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m  [shard  master]
  [1m[35mSwitchman::Shard Load (0.3ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."database_server_id" = 'production' AND "switchman_shards"."name" IS NULL ORDER BY "switchman_shards"."id" ASC LIMIT 1
  [1m[36mSwitchman::Shard Load (0.4ms)[0m  [1mSELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."default" = 't' ORDER BY "switchman_shards"."id" ASC LIMIT 1[0m  [shard 1 master]
Connecting to database specified by database.yml
  [1m[36m (6.1ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m
  [1m[35mSwitchman::Shard Load (1.5ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."default" = 't' LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m
  [1m[35mSwitchman::Shard Load (1.9ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."database_server_id" = 'test' AND "switchman_shards"."name" IS NULL LIMIT 1
  [1m[36m (0.4ms)[0m  [1mSELECT * FROM unnest(current_schemas(false))[0m  [shard  master]
  [1m[35mSwitchman::Shard Load (0.3ms)[0m  SELECT "switchman_shards".* FROM "switchman_shards" WHERE "switchman_shards"."database_server_id" = 'production' AND "switchman_shards"."name" IS NULL LIMIT 1
