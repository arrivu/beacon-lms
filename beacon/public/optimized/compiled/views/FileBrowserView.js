(function(){var e={}.hasOwnProperty,t=function(t,r){function o(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};define(["i18n!filebrowserview","Backbone","underscore","jst/FileBrowserView","compiled/views/FolderTreeView","compiled/models/Folder","compiled/str/splitAssetString"],function(e,r,o,i,s,n,l){var a,u;return a=function(r){function a(){return u=a.__super__.constructor.apply(this,arguments)}return t(a,r),a.prototype.template=i,a.optionProperty("contentTypes"),a.optionProperty("onlyShowFolders"),a.optionProperty("rootFoldersToShow"),a.optionProperty("onClick"),a.optionProperty("dndOptions"),a.optionProperty("href"),a.prototype.events={"keydown .folderTree[role=tree]":function(e){var t,r,o;switch(e.which){case 35:o="end";break;case 36:o="home";break;case 37:o="left";break;case 38:o="up";break;case 39:o="right";break;case 40:o="down";break;case 13:case 32:o="enter";break;default:return!0}if(e.preventDefault(),e.stopPropagation(),r=this.$folderTree.attr("aria-activedescendant"),!r)return this.focusFirst();switch(t=this.$folderTree.find("#"+r),o){case"up":return this.focusPrev(t);case"down":return this.focusNext(t);case"left":return this.collapseCurrent(t);case"right":return this.expandCurrent(t);case"home":return this.focusFirst();case"end":return this.focusLast(t);case"enter":return this.activateCurrent(t)}}},a.prototype.rootFolders=function(){var t=this;return this.rootFoldersToShow?this.rootFoldersToShow:a.rootFolders||(a.rootFolders=function(){var r,o,i,s;return r=null,o=l(ENV.context_asset_string||""),!o||2!==o.length||"courses"!==o[0]&&"groups"!==o[0]||(r=new n({contentTypes:t.contentTypes}),r.set("custom_name","courses"===o[0]?e.t("course_files","Course files"):e.t("group_files","Group files")),r.url="/api/v1/"+o[0]+"/"+o[1]+"/folders/root",r.fetch()),i=new n({contentTypes:t.contentTypes}),i.set("custom_name",e.t("my_files","My files")),i.url="/api/v1/users/self/folders/root",i.fetch(),s=[],r&&s.push(r),s.push(i),s}())},a.prototype.afterRender=function(){var e,t,r,o;for(this.$folderTree=this.$el.children(".folderTree"),o=this.rootFolders(),t=0,r=o.length;r>t;t++)e=o[t],new s({model:e,onlyShowFolders:this.onlyShowFolders,onClick:this.onClick,dndOptions:this.dndOptions,href:this.href}).$el.appendTo(this.$folderTree);return a.__super__.afterRender.apply(this,arguments)},a.prototype.setFocus=function(e,t){var r;if((null!=e?e.length:void 0)&&(null!=t&&"function"==typeof t.is?!t.is(e):!0))return this.$folderTree.find("[role=treeitem]").not(e).attr("aria-selected",!1),e.attr("aria-selected",!0),r=e.attr("id"),r||(r=o.uniqueId("treenode-"),e.attr("id",r)),this.$folderTree.attr("aria-activedescendant",r)},a.prototype.focusFirst=function(){return this.setFocus(this.$folderTree.find("[role=treeitem]:first"))},a.prototype.focusLast=function(e){var t,r;for(t=$folderTree.find("[role=treeitem][aria-level=1]"),r=1;this.ariaPropIsTrue(t,"aria-expanded")&&t.find("[role=treeitem]:first").length;)r++,t=t.find("[role=treeitem][aria-level="+r+"]:last");return this.setFocus(t,e),this.setFocus(this.$folderTree.find("[role=treeitem]:first"))},a.prototype.focusNext=function(e){var t,r,o,i;if(this.ariaPropIsTrue(e,"aria-expanded")&&(r=e.find("[role=treeitem]:first"),r.length))return this.setFocus(r,e);for(r=null,t=e,o=parseInt(e.attr("aria-level"),10);o>0;){if(i="[role=treeitem][aria-level="+o+"]",r=t.parentsUntil("[role=treeitem],[role=tree]").andSelf().nextAll().find(i).andSelf().filter(i).first(),null!=r?r.length:void 0)return this.setFocus(r,e);o--,t=t.parent().closest("[role=treeitem][aria-level="+o+"]")}},a.prototype.focusPrev=function(e){var t,r,o;if(r=parseInt(e.attr("aria-level"),10),o="[role=treeitem][aria-level="+r+"]",t=e.parentsUntil("[role=treeitem],[role=tree]").andSelf().prevAll().find(o).andSelf().filter(o).last(),!t.length)return t=e.parent().closest("[role=treeitem]"),this.setFocus(t,e);for(;this.ariaPropIsTrue(t,"aria-expanded")&&t.find("[role=treeitem]:first").length;)r++,t=t.find("[role=treeitem][aria-level="+r+"]:last");return this.setFocus(t,e)},a.prototype.expandCurrent=function(e){return this.ariaPropIsTrue(e,"aria-expanded")?this.setFocus(e.find("[role=treeitem]:first"),e):(e.find(".folderLabel:first").click(),this.$folderTree.focus())},a.prototype.collapseCurrent=function(e){return this.ariaPropIsTrue(e,"aria-expanded")?(e.find(".folderLabel:first").click(),this.$folderTree.focus()):this.setFocus(e.parent().closest("[role=treeitem]"),e)},a.prototype.activateCurrent=function(e){return e.find("a:first").click()},a.prototype.ariaPropIsTrue=function(e,t){var r;return"true"===(null!=(r=e.attr(t))&&"function"==typeof r.toLowerCase?r.toLowerCase():void 0)},a}(r.View)})}).call(this);