(function(){var e={}.hasOwnProperty,t=function(t,r){function s(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return s.prototype=r.prototype,t.prototype=new s,t.__super__=r.prototype,t};define(["i18n!conversations","jquery","underscore","Backbone","compiled/models/Message","compiled/views/conversations/MessageItemView","jst/conversations/messageDetail","jst/conversations/noMessage"],function(e,r,s,n,o,i,a,l){var c,h,g;return h=n.View,c=function(n){function o(){return g=o.__super__.constructor.apply(this,arguments)}return t(o,n),o.prototype.events={"click .message-detail-actions .reply-btn":"onReply","click .message-detail-actions .reply-all-btn":"onReplyAll","click .message-detail-actions .delete-btn":"onDelete","click .message-detail-actions .forward-btn":"onForward","click .message-detail-actions .archive-btn":"onArchive","click .message-detail-actions .star-toggle-btn":"onStarToggle",modelChange:"onModelChange","changed:starred":"render"},o.prototype.tagName="div",o.prototype.messages={star:e.t("star","Star"),unstar:e.t("unstar","Unstar"),archive:e.t("archive","Archive"),unarchive:e.t("unarchive","Unarchive")},o.prototype.render=function(e){var t,s,n=this;return null==e&&(e={}),o.__super__.render.apply(this,arguments),this.model?(s=this.model.toJSON().conversation,s.starToggleMessage=this.model.starred()?this.messages.unstar:this.messages.star,s.archiveToggleMessage="archived"===this.model.get("workflow_state")?this.messages.unarchive:this.messages.archive,t=r(a(s)),this.model.messageCollection.each(function(e){var r;return e.get("conversation_id")||e.set("conversation_id",s.id),r=new i({model:e}).render(),t.find(".message-content").append(r.$el),n.listenTo(r,"reply",function(){return n.trigger("reply",e)}),n.listenTo(r,"reply-all",function(){return n.trigger("reply-all",e)}),n.listenTo(r,"forward",function(){return n.trigger("forward",e)})})):t=l(e),this.$el.html(t),this.$el.find(".subject").focus(),this.$archiveToggle=this.$el.find(".archive-btn"),this.$starToggle=this.$el.find(".star-toggle-btn"),this},o.prototype.onModelChange=function(e){return this.detachModelEvents(),this.model=e,this.attachModelEvents()},o.prototype.detachModelEvents=function(){return this.model?this.model.off(null,null,this):void 0},o.prototype.attachModelEvents=function(){return this.model?this.model.on("change:starred change:workflow_state",s.debounce(this.updateLabels,90),this):void 0},o.prototype.updateLabels=function(){return this.$starToggle.text(this.model.starred()?this.messages.unstar:this.messages.star),this.$archiveToggle.text("archived"===this.model.get("workflow_state")?this.messages.unarchive:this.messages.archive)},o.prototype.onStarToggle=function(e){return e.preventDefault(),this.trigger("star-toggle")},o.prototype.onReply=function(e){return e.preventDefault(),this.trigger("reply")},o.prototype.onReplyAll=function(e){return e.preventDefault(),this.trigger("reply-all")},o.prototype.onForward=function(e){return e.preventDefault(),this.trigger("forward")},o.prototype.onDelete=function(e){return e.preventDefault(),this.trigger("delete")},o.prototype.onArchive=function(e){return e.preventDefault(),this.trigger("archive")},o}(h)})}).call(this);