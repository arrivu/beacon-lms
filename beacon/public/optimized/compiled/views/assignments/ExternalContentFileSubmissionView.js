(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function s(){this.constructor=t}for(var o in i)e.call(i,o)&&(t[o]=i[o]);return s.prototype=i.prototype,t.prototype=new s,t.__super__=i.prototype,t};define(["jquery","i18n!assignments","jst/assignments/ExternalContentHomeworkFileSubmissionView","compiled/views/assignments/ExternalContentHomeworkSubmissionView"],function(e,s,o,n){var r,u;return r=function(n){function r(){return this.uploadFailure=t(this.uploadFailure,this),this.uploadSuccess=t(this.uploadSuccess,this),this.submissionFailure=t(this.submissionFailure,this),this.disableLoader=t(this.disableLoader,this),this.redirectSuccessfulAssignment=t(this.redirectSuccessfulAssignment,this),this.submitAssignment=t(this.submitAssignment,this),this.checkFileStatus=t(this.checkFileStatus,this),this.submitHomework=t(this.submitHomework,this),u=r.__super__.constructor.apply(this,arguments)}return i(r,n),r.prototype.template=o,r.optionProperty("externalTool"),r.prototype.submitHomework=function(){return this.uploadFileFromUrl(this.externalTool,this.model)},r.prototype.checkFileStatus=function(t,i,s){var o=this;return e.ajaxJSON(t,"GET",{},function(e){"ready"===e.upload_status?i(e.attachment):"errored"===e.upload_status?s(e.message):setTimeout(function(){o.checkFileStatus(t,i,s)},2500)},function(t){return s(t.message)})},r.prototype.submitAssignment=function(t){var i,s;i={submission:{submission_type:"online_upload",file_ids:[t.id]},comment:{text_comment:this.assignmentSubmission.get("comment")}},s="/api/v1/courses/"+ENV.COURSE_ID+"/assignments/"+ENV.SUBMIT_ASSIGNMENT.ID+"/submissions",e.ajaxJSON(s,"POST",i,this.redirectSuccessfulAssignment,this.disableLoader)},r.prototype.redirectSuccessfulAssignment=function(){window.onbeforeunload=function(){},window.location.reload(),this.loaderPromise.resolve()},r.prototype.disableLoader=function(){return this.loaderPromise.resolve()},r.prototype.submissionFailure=function(){return this.loaderPromise.resolve(),this.$.find(".submit_button").text(s.t("file_retrieval_error","Retrieving File Failed")),e.flashError(s.t("invalid_file_retrieval","There was a problem retrieving the file sent from this tool."))},r.prototype.uploadSuccess=function(t){this.checkFileStatus(t.status_url,this.submitAssignment,this.submissionFailure)},r.prototype.uploadFailure=function(){this.loaderPromise.resolve(),this.$.find(".submit_button").text(s.t("file_retrieval_error","Retrieving File Failed"))},r.prototype.uploadFileFromUrl=function(t,i){var o,n;this.loaderPromise=e.Deferred(),this.assignmentSubmission=i,o={url:this.assignmentSubmission.get("url"),name:this.assignmentSubmission.get("text"),content_type:""},n="/api/v1/courses/"+ENV.COURSE_ID+"/assignments/"+ENV.SUBMIT_ASSIGNMENT.ID+"/submissions/"+ENV.current_user_id+"/files",e.ajaxJSON(n,"POST",o,this.uploadSuccess,this.uploadFailure),this.$el.disableWhileLoading(this.loaderPromise,{buttons:{".submit_button":s.t("getting_file","Retrieving File...")}})},r}(n)})}).call(this);