(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function s(){this.constructor=e}for(var n in i)t.call(i,n)&&(e[n]=i[n]);return s.prototype=i.prototype,e.prototype=new s,e.__super__=i.prototype,e};define(["i18n!assignments","Backbone","jquery","underscore","compiled/views/PublishIconView","compiled/views/assignments/DateDueColumnView","compiled/views/assignments/DateAvailableColumnView","compiled/views/assignments/CreateAssignmentView","compiled/views/MoveDialogView","compiled/fn/preventDefault","jst/assignments/AssignmentListItem","jst/assignments/_assignmentListItemScore","compiled/util/round","compiled/views/assignments/AssignmentKeyBindingsMixin","jqueryui/tooltip","compiled/behaviors/tooltip"],function(t,s,n,o,r,a,u,l,d,m,h,p,g,c){var _,f;return _=function(s){function _(){return this.focusOnFirstGroup=e(this.focusOnFirstGroup,this),this.focusOnGroupByID=e(this.focusOnGroupByID,this),this.focusOnGroup=e(this.focusOnGroup,this),this.focusOnAssignment=e(this.focusOnAssignment,this),this.previousAssignmentInGroup=e(this.previousAssignmentInGroup,this),this.nextAssignmentInGroup=e(this.nextAssignmentInGroup,this),this.nextVisibleGroup=e(this.nextVisibleGroup,this),this.visibleAssignments=e(this.visibleAssignments,this),this.assignmentGroupView=e(this.assignmentGroupView,this),this.showAssignment=e(this.showAssignment,this),this.addItem=e(this.addItem,this),this.deleteItem=e(this.deleteItem,this),this.editItem=e(this.editItem,this),this.goToPrevItem=e(this.goToPrevItem,this),this.goToNextItem=e(this.goToNextItem,this),this.updateScore=e(this.updateScore,this),this.onDelete=e(this.onDelete,this),this.createModuleToolTip=e(this.createModuleToolTip,this),this.toggleHidden=e(this.toggleHidden,this),this.updatePublishState=e(this.updatePublishState,this),f=_.__super__.constructor.apply(this,arguments)}return i(_,s),_.mixin(c),_.prototype.tagName="li",_.prototype.className="assignment",_.prototype.template=h,_.child("publishIconView","[data-view=publish-icon]"),_.child("dateDueColumnView","[data-view=date-due]"),_.child("dateAvailableColumnView","[data-view=date-available]"),_.child("editAssignmentView","[data-view=edit-assignment]"),_.child("moveAssignmentView","[data-view=moveAssignment]"),_.prototype.els={".edit_assignment":"$editAssignmentButton",".move_assignment":"$moveAssignmentButton"},_.prototype.events={"click .delete_assignment":"onDelete","click .tooltip_link":m(function(){}),keydown:"handleKeys"},_.prototype.messages={confirm:t.t("confirms.delete_assignment","Are you sure you want to delete this assignment?"),ag_move_label:t.beforeLabel("assignment_group_move_label","Assignment Group")},_.prototype.initialize=function(){var e,t;return _.__super__.initialize.apply(this,arguments),this.initializeChildViews(),this.model.assignmentView=this,this.model.on("change:hidden",this.toggleHidden),this.canManage()&&(this.model.on("change:published",this.updatePublishState),e=["name","points_possible","due_at","lock_at","unlock_at","modules"],t=o.map(e,function(e){return"change:"+e}).join(" "),this.model.on(t,this.render)),this.model.on("change:submission",this.updateScore)},_.prototype.initializeChildViews=function(){var e;return this.publishIconView=!1,this.editAssignmentView=!1,this.dateAvailableColumnView=!1,this.moveAssignmentView=!1,this.canManage()&&(this.publishIconView=new r({model:this.model}),this.editAssignmentView=new l({model:this.model}),this.moveAssignmentView=new d({model:this.model,nested:!0,parentCollection:null!=(e=this.model.collection.view)?e.parentCollection:void 0,parentLabelText:this.messages.ag_move_label,parentKey:"assignment_group_id",childKey:"assignments",closeTarget:this.$el.find("a[id*=manage_link]"),saveURL:function(){return""+ENV.URLS.assignment_sort_base_url+"/"+this.parentListView.value()+"/reorder"}})),this.dateDueColumnView=new a({model:this.model}),this.dateAvailableColumnView=new u({model:this.model})},_.prototype.updatePublishState=function(){return this.$(".ig-row").toggleClass("ig-published",this.model.get("published"))},_.prototype.render=function(){return this.toggleHidden(this.model,this.model.get("hidden")),this.publishIconView&&this.publishIconView.remove(),this.editAssignmentView&&this.editAssignmentView.remove(),this.dateDueColumnView&&this.dateDueColumnView.remove(),this.dateAvailableColumnView&&this.dateAvailableColumnView.remove(),this.moveAssignmentView&&this.moveAssignmentView.remove(),_.__super__.render.apply(this,arguments),this.model?this.model.view=this:void 0},_.prototype.afterRender=function(){return this.createModuleToolTip(),this.editAssignmentView&&(this.editAssignmentView.hide(),this.editAssignmentView.setTrigger(this.$editAssignmentButton)),this.moveAssignmentView&&(this.moveAssignmentView.hide(),this.moveAssignmentView.setTrigger(this.$moveAssignmentButton)),!this.canManage()&&this.userIsStudent()?this.updateScore():void 0},_.prototype.toggleHidden=function(e,t){return this.$el.toggleClass("hidden",t),this.$el.toggleClass("search_show",!t)},_.prototype.createModuleToolTip=function(){var e;return e=this.$el.find(".tooltip_link"),e.length>0?e.tooltip({position:{my:"center bottom",at:"center top-10",collision:"fit fit"},tooltipClass:"center bottom vertical",content:function(){return n(e.data("tooltipSelector")).html()}}):void 0},_.prototype.toJSON=function(){var e,t,i,s,n,r,a,u=this;return e=this.model.toView(),e.canManage=this.canManage(),e.canManage||(e=this._setJSONForGrade(e)),e.canMove=(null!=(r=this.model.collection.view)&&null!=(a=r.parentCollection)?a.length:void 0)>1||this.model.collection.length>1,e.canManage?(e.spanWidth="span3",e.alignTextClass=""):(e.spanWidth="span4",e.alignTextClass="align-right"),this.model.isQuiz()?(e.menu_tools=ENV.quiz_menu_tools,o.each(e.menu_tools,function(e){return e.url=e.base_url+("&quizzes[]="+u.model.get("quiz_id"))})):this.model.isDiscussionTopic()?(e.menu_tools=ENV.discussion_topic_menu_tools,o.each(e.menu_tools,function(e){return e.url=e.base_url+("&discussion_topics[]="+u.model.get("discussion_topic_id"))})):(e.menu_tools=ENV.assignment_menu_tools,o.each(e.menu_tools,function(e){return e.url=e.base_url+("&assignments[]="+u.model.get("id"))})),(n=this.model.get("modules"))?(s=n[0],t=n.length>0,i=n.join(","),o.extend(e,{modules:n,module_count:n.length,module_name:s,has_modules:t,joined_names:i})):e},_.prototype.onDelete=function(e){var t;return e.preventDefault(),confirm(this.messages.confirm)?null!=this.previousAssignmentInGroup()?(this.focusOnAssignment(this.previousAssignmentInGroup()),this["delete"]()):(t=this.model.attributes.assignment_group_id,this["delete"](),this.focusOnGroupByID(t)):this.$el.find("a[id*=manage_link]").focus()},_.prototype["delete"]=function(){return this.model.destroy(),this.$el.remove()},_.prototype.canManage=function(){return ENV.PERMISSIONS.manage},_.prototype.gradeStrings=function(e){var i;return i={incomplete:t.t("incomplete","Incomplete"),complete:t.t("complete","Complete")},e=i[e]||e,{percent:{nonscreenreader:t.t("grade_percent","%{grade}%",{grade:e}),screenreader:t.t("grade_percent_screenreader","Grade: %{grade}%",{grade:e})},pass_fail:{nonscreenreader:""+e,screenreader:t.t("grade_pass_fail_screenreader","Grade: %{grade}",{grade:e})},letter_grade:{nonscreenreader:""+e,screenreader:t.t("grade_letter_grade_screenreader","Grade: %{grade}",{grade:e})},gpa_scale:{nonscreenreader:""+e,screenreader:t.t("grade_gpa_scale_screenreader","Grade: %{grade}",{grade:e})}}},_.prototype._setJSONForGrade=function(e){var t,i,s,n,o,r;return(o=this.model.get("submission"))&&(r=o.present?o.present():o.toJSON(),n=o.get("score"),"number"!=typeof n||isNaN(n)||(r.score=g(n,g.DEFAULT)),e.submission=r,t=o.get("grade"),i=this.gradeStrings(t)[e.gradingType],e.submission.gradeDisplay=null!=i?i.nonscreenreader:void 0,e.submission.gradeDisplayForScreenreader=null!=i?i.screenreader:void 0),s=e.pointsPossible,"number"!=typeof s||isNaN(s)||(e.pointsPossible=g(s,g.DEFAULT),null!=e.submission&&(e.submission.pointsPossible=e.pointsPossible)),null!=e.submission&&(e.submission.gradingType=e.gradingType),"not_graded"===e.gradingType&&(e.hideGrade=!0),e},_.prototype.updateScore=function(){var e;return e=this.model.toView(),this.canManage()||(e=this._setJSONForGrade(e)),this.$(".js-score").html(p(e))},_.prototype.userIsStudent=function(){return o.include(ENV.current_user_roles,"student")},_.prototype.goToNextItem=function(){return null!=this.nextAssignmentInGroup()?this.focusOnAssignment(this.nextAssignmentInGroup()):null!=this.nextVisibleGroup()?this.focusOnGroup(this.nextVisibleGroup()):this.focusOnFirstGroup()},_.prototype.goToPrevItem=function(){return null!=this.previousAssignmentInGroup()?this.focusOnAssignment(this.previousAssignmentInGroup()):this.focusOnGroupByID(this.model.attributes.assignment_group_id)},_.prototype.editItem=function(){return this.$("#assignment_"+this.model.id+"_settings_edit_item").click()},_.prototype.deleteItem=function(){return this.$("#assignment_"+this.model.id+"_settings_delete_item").click()},_.prototype.addItem=function(){var e;return e=this.model.attributes.assignment_group_id,n(".add_assignment","#assignment_group_"+e).click()},_.prototype.showAssignment=function(){return n(".ig-title","#assignment_"+this.model.id)[0].click()},_.prototype.assignmentGroupView=function(){return this.model.collection.view},_.prototype.visibleAssignments=function(){return this.assignmentGroupView().visibleAssignments()},_.prototype.nextVisibleGroup=function(){return this.assignmentGroupView().nextGroup()},_.prototype.nextAssignmentInGroup=function(){var e;return e=this.visibleAssignments().indexOf(this.model),this.visibleAssignments()[e+1]},_.prototype.previousAssignmentInGroup=function(){var e;return e=this.visibleAssignments().indexOf(this.model),this.visibleAssignments()[e-1]},_.prototype.focusOnAssignment=function(e){return n("#assignment_"+e.id).attr("tabindex",-1).focus()},_.prototype.focusOnGroup=function(e){return n("#assignment_group_"+e.attributes.id).attr("tabindex",-1).focus()},_.prototype.focusOnGroupByID=function(e){return n("#assignment_group_"+e).attr("tabindex",-1).focus()},_.prototype.focusOnFirstGroup=function(){return n(".assignment_group").filter(":visible").first().attr("tabindex",-1).focus()},_}(s.View)})}).call(this);