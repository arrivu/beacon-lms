(function(){var e={}.hasOwnProperty,t=function(t,n){function o(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t};define(["Backbone","jquery","underscore","compiled/fn/preventDefault","compiled/models/Folder","compiled/views/PaginatedCollectionView","compiled/views/FileItemView","jst/FolderTreeCollection"],function(e,n,o,i,r,l,s,d){var a,p;return a=function(e){function i(){return p=i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.tagName="li",i.optionProperty("nestingLevel"),i.optionProperty("onlyShowFolders"),i.optionProperty("onClick"),i.optionProperty("dndOptions"),i.optionProperty("href"),i.prototype.defaults={nestingLevel:1},i.prototype.attributes=function(){return{role:"treeitem","aria-expanded":""+!!this.model.isExpanded,"aria-level":this.nestingLevel,id:this.tagId}},i.prototype.events={"click .folderLabel":"toggle"},i.prototype.initialize=function(){var e;return this.tagId=o.uniqueId("treenode-"),this.render=o.debounce(this.render),this.model.on("all",this.render,this),this.model.files.on("all",this.render,this),this.model.folders.on("all",this.render,this),e=i.__super__.initialize.apply(this,arguments),this.render(),e},i.prototype.render=function(){return this.renderSelf(),this.renderContents()},i.prototype.toggle=function(e){return e.preventDefault(),e.stopPropagation(),this.model.toggle({onlyShowFolders:this.onlyShowFolders}),this.$el.attr(this.attributes())},i.prototype.title_text=function(){return this.model.get("custom_name")||this.model.get("name")},i.prototype.renderSelf=function(){var e=this;return this.$el.attr(this.attributes()),this.$label||(this.$label=function(){var t,o;return e.$labelInner=n("<span>").click(function(t){return"function"==typeof e.onClick?e.onClick(t,e.model):void 0}),t=n('<a\n  class="folderLabel"\n  role="presentation"\n  tabindex="-1"\n>\n  <i class="icon-mini-arrow-right"></i>\n  <i class="icon-folder"></i>\n</a>').append(e.$labelInner).prependTo(e.$el),e.dndOptions&&(o=function(e){return function(){return t.toggleClass("activeDragTarget",e)}},t.on({"dragenter dragover":function(t){return e.dndOptions.onItemDragEnterOrOver(t.originalEvent,o(!0))},"dragleave dragend":function(t){return e.dndOptions.onItemDragLeaveOrEnd(t.originalEvent,o(!1))},drop:function(t){return e.dndOptions.onItemDrop(t.originalEvent,e.model,o(!1))}})),t}()),this.$labelInner.text(this.title_text()),this.$label.attr("href",("function"==typeof this.href?this.href(this.model):void 0)||"#").toggleClass("expanded",!!this.model.isExpanded).toggleClass("loading after",!!this.model.isExpanding)},i.prototype.renderContents=function(){var e,t;return this.model.isExpanded?(this.$folderContents||(this.$folderContents=n("<ul role='group' class='folderContents'/>").appendTo(this.$el),t=new l({collection:this.model.folders,itemView:i,itemViewOptions:{nestingLevel:this.nestingLevel+1,onlyShowFolders:this.onlyShowFolders,onClick:this.onClick,dndOptions:this.dndOptions,href:this.href},tagName:"li",className:"folders",template:d,scrollContainer:this.$folderContents.closest("ul[role=tabpanel]")}),this.$folderContents.append(t.render().el),this.onlyShowFolders||(e=new l({collection:this.model.files,itemView:s,itemViewOptions:{nestingLevel:this.nestingLevel+1},tagName:"li",className:"files",template:d,scrollContainer:this.$folderContents.closest("ul[role=tabpanel]")}),this.$folderContents.append(e.render().el))),this.$("> .folderContents").removeClass("hidden")):this.$("> .folderContents").addClass("hidden")},i}(e.View)})}).call(this);