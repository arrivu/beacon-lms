(function(){define(["Backbone","i18n!assignments","jquery","underscore","jst/assignments/homework_submission_tool","compiled/views/ExternalTools/ExternalContentReturnView","compiled/external_tools/ExternalToolCollection","compiled/views/assignments/ExternalContentFileSubmissionView","compiled/views/assignments/ExternalContentUrlSubmissionView","jquery.disableWhileLoading"],function(e,o,t,n,i,r,s,l,a){var u;return u=function(){function u(e){this.renderedViews={},this.toolsForm=t(e),this.externalToolCollection=new s,this.externalToolCollection.add(ENV.EXTERNAL_TOOLS)}return u.prototype.loadExternalTools=function(){var e=this;return this.externalToolCollection.length>0?(t(".submit_from_external_tool_option").parent().show(),this.toolsForm.find("ul.tools").empty(),this.externalToolCollection.forEach(function(o){return e.addToolToMoreList(o)})):this.toolsForm.find("ul.tools li").text(o.t("no_tools_found","No tools found"))},u.prototype.embedLtiLaunch=function(e){var o,n;return n=this.externalToolCollection.findWhere({id:e.toString(10)}),this.cleanupViewsForTool(n),o=this.createReturnView(n),t("#submit_from_external_tool_form_"+e).append(o.el),o.render(),this.renderedViews[e.toString(10)].push(o)},u.prototype.cleanupViewsForTool=function(e){var o;return n.has(this.renderedViews,e.get("id"))&&(o=this.renderedViews[e.get("id")],o.forEach(function(e){return e.remove()})),this.renderedViews[e.get("id")]=[]},u.prototype.cancelSubmission=function(){return t("#submit_assignment").hide(),t(".submit_assignment_link").show()},u.prototype.addToolToMoreList=function(e){var o,n;return e.attributes.display_text=e.get("homework_submission").label,n=i(e.attributes),o=t(n).data("tool",e),this.toolsForm.find("ul.tools").append(o)},u.prototype.createReturnView=function(e){var o,n=this;return o=new r({model:e,launchType:"homework_submission",launchParams:{assignment_id:ENV.SUBMIT_ASSIGNMENT.ID},displayAsModal:!1}),o.on("ready",function(o){var i;return e=this.model,i=n.createHomeworkSubmissionView(e,o),i.parentView=n,this.remove(),t("#submit_from_external_tool_form_"+e.get("id")).append(i.el),n.cleanupViewsForTool(e),n.renderedViews[e.get("id")].push(i),i.render()}),o.on("cancel",function(){}),o},u.prototype.createHomeworkSubmissionView=function(o,t){var n;return n="file"===t.return_type?new l({externalTool:o,model:new e.Model(t)}):new a({externalTool:o,model:new e.Model(t)}),n.on("relaunchTool",function(e){return this.remove(),this.parentView.embedLtiLaunch(e.get("id"))}),n.on("cancel",function(){return this.parentView.cancelSubmission()}),n},u}()})}).call(this);