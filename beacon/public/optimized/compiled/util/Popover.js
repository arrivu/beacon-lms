(function(){var t=function(t,i){return function(){return t.apply(i,arguments)}};define(["jquery"],function(i){var e,o,r,s;return s=function(t,e){return i(this).css(t).toggleClass("carat-bottom","bottom"===e.vertical)},r=0,o=[],e=function(){function e(e,o,r){var s=this;this.content=o,this.options=null!=r?r:{},this.position=t(this.position,this),this.outsideClickHandler=t(this.outsideClickHandler,this),this.trigger=i(e.currentTarget),this.el=i(this.content).addClass("carat-bottom").data("popover",this).keydown(function(t){var e,o;if(t.keyCode===i.ui.keyCode.ESCAPE&&(s.hide(),s.previousTarget&&s.previousTarget.is(":visible")&&s.previousTarget.focus()),t.keyCode===i.ui.keyCode.TAB&&(o=i(":tabbable",s.el),e=i.inArray(t.target,o),-1!==e))if(t.shiftKey){if(0===e)return s.hide()}else if(e===o.length-1)return s.hide()}),this.el.delegate(".popover_close","click",function(t){return t.preventDefault(),s.hide(),s.previousTarget&&s.previousTarget.is(":visible")?s.previousTarget.focus():void 0}),this.show(e)}return e.prototype.show=function(t){for(var e,s,n,a,h,l,u,c=this;l=o.pop();)l.hide();return o.push(this),a="popover-"+r++,this.trigger.attr({"aria-expanded":!0,"aria-controls":a}),this.previousTarget=t.currentTarget,this.el.attr({id:a}).appendTo(document.body).show(),this.position(),this.el.find(":tabbable").first().focus(),setTimeout(function(){return c.el.find(":tabbable").first().focus()},100),this.el.find(".ui-menu-carat").remove(),n=this.trigger.offset().left-this.el.offset().left,e=t.pageX-this.trigger.offset().left,h=Math.max(0,this.trigger.width()/2-this.el.width()/2)+20,u=this.trigger.width()-h,s=Math.min(Math.max(h,e),u)+n,i('<span class="ui-menu-carat"><span /></span>').css("left",s).prependTo(this.el),this.positionInterval=setInterval(this.position,200),i(window).click(this.outsideClickHandler)},e.prototype.hide=function(){var t,e,r,s;for(t=r=0,s=o.length;s>r;t=++r)e=o[t],this===e&&o.splice(t,1);return this.el.detach(),this.trigger.attr("aria-expanded",!1),clearInterval(this.positionInterval),i(window).unbind("click",this.outsideClickHandler)},e.prototype.ignoreOutsideClickSelector=".ui-dialog",e.prototype.outsideClickHandler=function(t){return i(t.target).closest(this.el.add(this.trigger).add(this.ignoreOutsideClickSelector)).length?void 0:this.hide()},e.prototype.position=function(){return this.el.position({my:"center "+("bottom"===this.options.verticalSide?"top":"bottom"),at:"center "+(this.options.verticalSide||"top"),of:this.trigger,offset:"0 -10px",within:"body",collision:"flipfit "+(this.options.verticalSide?"none":"flipfit"),using:s})},e}()})}).call(this);