(function(){var t=function(t,r){return function(){return t.apply(r,arguments)}},r={}.hasOwnProperty,e=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},n=[].slice;define(["jquery","underscore","compiled/models/FilesystemObject","jquery.ajaxJSON"],function(r,i,s){var u,o;return u=function(u){function a(){return this.saveFrd=t(this.saveFrd,this),o=a.__super__.constructor.apply(this,arguments)}return e(a,u),a.prototype.url=function(){return this.isNew()?a.__super__.url.apply(this,arguments):"/api/v1/files/"+this.id},a.prototype.initialize=function(t,r){return this.preflightUrl=r.preflightUrl,a.__super__.initialize.apply(this,arguments)},a.prototype.save=function(t,e){var n,i,s,u=this;return null==t&&(t={}),null==e&&(e={}),this.get("file")?(this.set(t),n=r.Deferred(),i=this.get("file"),s=(i.value||i.name).split(/[\/\\]/).pop(),r.ajaxJSON(this.preflightUrl,"POST",{name:s,on_duplicate:"rename"},function(t){return u.saveFrd(t,n,i,e)},function(t){return n.reject(t),"function"==typeof e.error?e.error(t):void 0}),n):a.__super__.save.apply(this,arguments)},a.prototype.saveFrd=function(t,r,e,n){return t.attachments&&t.attachments[0]&&(t=t.attachments[0]),this.uploadParams=t.upload_params,this.set(this.uploadParams),e.name=t.file_param,this.url=function(){return t.upload_url},s.prototype.save.call(this,null,{multipart:!0,success:function(t){return r.resolve(t),"function"==typeof n.success?n.success(t):void 0},error:function(t){return r.reject(t),"function"==typeof n.error?n.error(t):void 0}})},a.prototype.toJSON=function(){var t;return this.get("file")?i.pick.apply(i,[this.attributes,"file"].concat(n.call(i.keys(null!=(t=this.uploadParams)?t:{})))):a.__super__.toJSON.apply(this,arguments)},a.prototype.present=function(){return i.clone(this.attributes)},a}(s)})}).call(this);