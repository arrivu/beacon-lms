(function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};define(["require","compiled/models/FilesystemObject","underscore","vendor/backbone-identity-map","compiled/collections/PaginatedCollection","compiled/collections/FilesCollection"],function(e,r,n,o,i,s){var l,p,u,d,a;return l=o(u=function(r){function n(){return d=n.__super__.constructor.apply(this,arguments)}var o,i,u;return t(n,r),n.prototype.defaults={name:""},n.prototype.initialize=function(e){return this.contentTypes||(this.contentTypes=null!=e?e.contentTypes:void 0),this.setUpFilesAndFoldersIfNeeded(),this.on("change:sort change:order",this.setQueryStringParams),n.__super__.initialize.apply(this,arguments)},n.prototype.url=function(){return this.isNew()?n.__super__.url.apply(this,arguments):"/api/v1/folders/"+this.id},n.prototype.parse=function(e){var t;return t=n.__super__.parse.apply(this,arguments),this.contentTypes||(this.contentTypes=e.contentTypes),this.setUpFilesAndFoldersIfNeeded(),this.folders.url=e.folders_url,this.files.url=e.files_url,t},n.prototype.setUpFilesAndFoldersIfNeeded=function(){return this.folders||(this.folders=new p([],{parentFolder:this})),this.files?void 0:this.files=new s([],{parentFolder:this})},n.prototype.expand=function(e,t){var r,n,o=this;return null==e&&(e=!1),null==t&&(t={}),this.isExpanded=!0,this.trigger("expanded"),this.expandDfd||e?$.when():(this.isExpanding=!0,this.trigger("beginexpanding"),this.expandDfd=$.Deferred().done(function(){return o.isExpanding=!1,o.trigger("endexpanding")}),n=this.folders.url===this.folders.constructor.prototype.url||this.files.url===this.files.constructor.prototype.url,(n||e)&&(r=this.fetch()),$.when(r).done(function(){var e,r;return 0!==o.get("folders_count")&&(r=o.folders.fetch()),0===o.get("files_count")||t.onlyShowFolders||(e=o.files.fetch()),$.when(r,e).done(o.expandDfd.resolve)}))},n.prototype.collapse=function(){return this.isExpanded=!1,this.trigger("collapsed")},n.prototype.toggle=function(e){return this.isExpanded?this.collapse():this.expand(!1,e)},n.prototype.previewUrl=function(){var e;return"Course"===(e=this.get("context_type"))||"Group"===e?"/"+(this.get("context_type").toLowerCase()+"s")+"/"+this.get("context_id")+"/files/{{id}}/preview":void 0},n.prototype.isEmpty=function(){return!(!this.files.loadedAll||0!==this.files.length)&&this.folders.loadedAll&&0===this.folders.length},o=/^[^\/]+\/?/,i=null,n.prototype.urlPath=function(){var t,r;return r=(this.get("full_name")||"").replace(o,""),i||(i=e("compiled/react_files/modules/filesEnv")),i.showingAllContexts&&(t=""+this.get("context_type").toLowerCase()+"s_"+this.get("context_id"),r=t+"/"+r),r},n.resolvePath=function(e,t,r){var n;return n="/api/v1/"+e+"/"+t+"/folders/by_path"+r,$.get(n).pipe(function(e){return e.map(function(e){return new l(e,{parse:!0})})})},u=function(e,t){var r;return"name"!==t||e instanceof l?"user"===t?null!=(r=e.get("user"))?r.display_name:void 0:e.get(t):e.get("display_name")},n.prototype.childrenSorter=function(e,t,r,n){var o;return null==e&&(e="name"),null==t&&(t="asc"),r=u(r,e),n=u(n,e),o=function(){if(r===n)return 0;if(r>n||void 0===r)return 1;if(n>r||void 0===n)return-1;throw new Error("wat? error sorting")}(),"desc"===t&&(o=0-o),o},n.prototype.children=function(e){var t,r;return r=e.sort,t=e.order,this.folders.toArray().concat(this.files.toArray()).sort(this.childrenSorter.bind(null,r,t))},n}(r)),l.FoldersCollection=p=function(e){function r(){return a=r.__super__.constructor.apply(this,arguments)}return t(r,e),r.optionProperty("parentFolder"),r.prototype.model=l,r.prototype.parse=function(e){var t=this;return e&&n.each(e,function(e){return e.contentTypes=t.parentFolder.contentTypes}),r.__super__.parse.apply(this,arguments)},r}(i),l})}).call(this);