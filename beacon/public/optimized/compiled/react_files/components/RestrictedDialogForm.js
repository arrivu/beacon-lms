(function(){define(["jquery","react","compiled/react/shared/utils/withReactDOM","i18n!restrict_student_access","../modules/customPropTypes","jquery.instructure_date_and_time","jquery.instructure_forms"],function(e,t,a,i,n){var s;return s=t.createClass({displayName:"RestrictedDialogForm",propTypes:{closeDialog:t.PropTypes.func.isRequired,models:t.PropTypes.arrayOf(n.filesystemObject)},getInitialState:function(){var e,t,a,i=this;return a=["hidden","locked","lock_at","unlock_at"],t={},e=this.props.models.every(function(e){return a.every(function(t){return i.props.models[0].get(t)===e.get(t)||!i.props.models[0].get(t)&&!e.get(t)})}),e&&(t=this.props.models[0].pick(a),t.selectedOption=t.locked?"unpublished":t.hidden?"link_only":t.lock_at||t.unlock_at?"date_range":"published"),t},componentDidMount:function(){return e([this.refs.unlock_at.getDOMNode(),this.refs.lock_at.getDOMNode()]).datetime_field(),e(this.getDOMNode()).find(":tabbable:first").focus()},extractFormValues:function(){return{hidden:"link_only"===this.state.selectedOption,unlock_at:"date_range"===this.state.selectedOption&&this.refs.unlock_at.getDOMNode().value||"",lock_at:"date_range"===this.state.selectedOption&&this.refs.lock_at.getDOMNode().value||"",locked:"unpublished"===this.state.selectedOption}},handleSubmit:function(t){var a,i,n,s=this;return t.preventDefault(),a=this.extractFormValues(),n=this.props.models.map(function(e){return e.save({},{attrs:a})}),i=e.when.apply(e,n),i.done(function(){return s.props.closeDialog()}),e(this.refs.dialogForm.getDOMNode()).disableWhileLoading(i)},render:a(function(){var t,a,n=this;return form({ref:"dialogForm",onSubmit:this.handleSubmit,className:"form-horizontal form-dialog permissions-dialog-form",title:i.t("title.limit_student_access","Permissions")},div({className:"radio"},label({},input({ref:"publishInput",type:"radio",name:"permissions",checked:"published"===this.state.selectedOption,onChange:function(){return n.setState({selectedOption:"published"})}},i.t("options.publish.description","Publish")))),div({className:"radio"},label({},input({ref:"unpublishInput",type:"radio",name:"permissions",checked:"unpublished"===this.state.selectedOption,onChange:function(){return n.setState({selectedOption:"unpublished"})}},i.t("options.unpublish.description","Unpublish")))),div({className:"radio"},label({},input({ref:"permissionsInput",type:"radio",name:"permissions",checked:"link_only"===(t=this.state.selectedOption)||"date_range"===t,onChange:function(){return n.setState({selectedOption:n.state.unlock_at?"date_range":"link_only"})}},i.t("options.restrictedAccess.description","Restricted Access")))),div({style:{"margin-left":"20px",display:"link_only"===(a=this.state.selectedOption)||"date_range"===a?"block":"none"}},div({className:"radio"},label({},input({ref:"link_only",type:"radio",name:"restrict_options",checked:"link_only"===this.state.selectedOption,onChange:function(){return n.setState({selectedOption:"link_only"})}},i.t("options.hiddenInput.description","Only available to students with link. Not visible in student files.")))),div({className:"radio"},label({},input({ref:"dateRange",type:"radio",name:"restrict_options",checked:"date_range"===this.state.selectedOption,onChange:function(){return n.setState({selectedOption:"date_range"})}}),i.t("options_2.description","Schedule student availability"))),div({className:"control-group",style:{display:"date_range"===this.state.selectedOption?"block":"none"}},label({className:"control-label dialog-adapter-form-calendar-label"},i.t("label.availableFrom","Lock From")),div({className:"controls dateSelectInputContainer"},input({ref:"unlock_at",defaultValue:this.state.unlock_at?e.datetimeString(this.state.unlock_at):void 0,className:"form-control dateSelectInput",type:"text","aria-label":i.t("aria_label.availableFrom","From")})),div({className:"control-group"},label({className:"control-label dialog-adapter-form-calendar-label"},i.t("label.availableUntil","Lock Until")),div({className:"controls dateSelectInputContainer"},input({ref:"lock_at",defaultValue:this.state.lock_at?e.datetimeString(this.state.lock_at):void 0,className:"form-control dateSelectInput",type:"text","aria-label":i.t("aria_label.availableUntil","Until")}))))),div({className:"form-controls"},button({type:"button",onClick:this.props.closeDialog,className:"btn"},i.t("button_text.cancel","Cancel")),button({ref:"updateBtn",type:"submit",className:"btn btn-primary",disabled:!this.state.selectedOption},i.t("button_text.update","Update"))))})})})}).call(this);